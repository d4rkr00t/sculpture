{"id":"../commands-common/compiler.ts","dependencies":[{"name":"/Users/ssysoev/Development/opaline/packages/core/tsconfig.json","includedInParent":true,"mtime":1565775214928},{"name":"/Users/ssysoev/Development/opaline/packages/core/package.json","includedInParent":true,"mtime":1582591471850},{"name":"./project-info","loc":{"line":54,"column":29},"parent":"/Users/ssysoev/Development/opaline/packages/core/commands-common/compiler.ts","resolved":"/Users/ssysoev/Development/opaline/packages/core/commands-common/project-info.ts"},{"name":"./commands-parser","loc":{"line":55,"column":32},"parent":"/Users/ssysoev/Development/opaline/packages/core/commands-common/compiler.ts","resolved":"/Users/ssysoev/Development/opaline/packages/core/commands-common/commands-parser.ts"},{"name":"./entry-generator","loc":{"line":56,"column":32},"parent":"/Users/ssysoev/Development/opaline/packages/core/commands-common/compiler.ts","resolved":"/Users/ssysoev/Development/opaline/packages/core/commands-common/entry-generator.ts"},{"name":"./link","loc":{"line":57,"column":21},"parent":"/Users/ssysoev/Development/opaline/packages/core/commands-common/compiler.ts","resolved":"/Users/ssysoev/Development/opaline/packages/core/commands-common/link.ts"}],"generated":{"js":"\"use strict\";var t=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{c(n.next(t))}catch(e){o(e)}}function u(t){try{c(n.throw(t))}catch(e){o(e)}}function c(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(s,u)}c((n=n.apply(t,e||[])).next())})},e=this&&this.__generator||function(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},\"function\"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(r)throw new TypeError(\"Generator is already executing.\");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(u){o=[6,u],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}},r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};exports.__esModule=!0;var i=r(require(\"path\")),o=r(require(\"fs\")),s=require(\"util\"),u=r(require(\"rollup\")),c=n(require(\"rollup-plugin-typescript\")),a=n(require(\"rimraf\")),l=require(\"./project-info\"),h=require(\"./commands-parser\"),p=require(\"./entry-generator\"),f=require(\"./link\"),d=s.promisify(o.readdir),m=s.promisify(o.writeFile),y=s.promisify(o.chmod),b=s.promisify(a.default),v=function(){function r(r){var n=this,i=r.cwd,o=r.mode,s=void 0===o?\"development\":o;this.onBundled=function(){return t(n,void 0,void 0,function(){var t,r;return e(this,function(e){switch(e.label){case 0:return[4,h.parseCommands(this.project,this.commands)];case 1:return t=e.sent(),r=p.createEntryPoint({project:this.project,commandsData:t}),[4,m(this.project.binOutputPath,r,\"utf8\")];case 2:return e.sent(),[4,y(this.project.binOutputPath,\"755\")];case 3:return e.sent(),\"development\"!==this.mode?[3,5]:[4,f.link()];case 4:e.sent(),e.label=5;case 5:return[2]}})})},this.cwd=i,this.mode=s}return r.prototype.init=function(r){return t(this,void 0,void 0,function(){var t,n;return e(this,function(e){switch(e.label){case 0:return t=this,[4,l.getProjectInfo(this.cwd)];case 1:return t.project=e.sent(),n=this,[4,this.getCommands()];case 2:return n.commands=e.sent(),this.bundlerConfig=this.createBundlerConfig(r),[2]}})})},r.prototype.refresh=function(){return t(this,void 0,void 0,function(){var t;return e(this,function(e){switch(e.label){case 0:return t=this,[4,this.getCommands()];case 1:return t.commands=e.sent(),[2]}})})},r.prototype.createBundlerConfig=function(t){return{input:this.getEntryPoints(this.commands),output:{dir:this.project.commandsOutputPath,format:\"cjs\"},onwarn:function(t){\"UNRESOLVED_IMPORT\"!==t.code&&console.log(t.message)},plugins:[c.default({rootDir:this.project.projectRootDir,allowJs:!0,esModuleInterop:!0,target:\"ES2017\"})]}},r.prototype.getCommands=function(){return t(this,void 0,void 0,function(){return e(this,function(t){switch(t.label){case 0:return[4,d(this.project.commandsDirPath)];case 1:return[2,t.sent().filter(function(t){return!t.endsWith(\".d.ts\")&&!t.endsWith(\".map\")&&!t.startsWith(\"_\")})]}})})},r.prototype.getEntryPoints=function(t){var e=this;return t.map(function(t){return i.join(e.project.commandsDirPath,t)})},r.prototype.createBundler=function(){if(this.bundlerConfig)return this.bundler},r.prototype.compile=function(r){var n=r.watch;return t(this,void 0,void 0,function(){return e(this,function(t){switch(t.label){case 0:return[4,this.init(n)];case 1:return t.sent(),n?(this.bundler=u.watch(this.bundlerConfig),[3,4]):[3,2];case 2:return[4,this.build()];case 3:t.sent(),t.label=4;case 4:return[2]}})})},r.prototype.build=function(){return t(this,void 0,void 0,function(){var t,r,n,i,o,s,c,a;return e(this,function(e){switch(e.label){case 0:return t=process.hrtime(),[4,u.rollup(this.bundlerConfig)];case 1:r=e.sent(),e.label=2;case 2:return e.trys.push([2,6,,7]),[4,b(this.project.commandsOutputPath)];case 3:return e.sent(),[4,r.write(this.bundlerConfig.output)];case 4:return[4,e.sent()];case 5:for(n=e.sent(),i=process.hrtime(t),console.log(\"\\n[DONE] Compiled successfully in \"+(i[0]/1e3+i[1]/1e6).toFixed(2)+\"ms!\\n\"),o=0,s=n.output;o<s.length;o++)\"chunk\"===(c=s[o]).type&&c.isEntry&&console.log(\"â€“ \"+c.fileName);return[3,7];case 6:return a=e.sent(),console.error(a),[3,7];case 7:return[2]}})})},r}();exports.Compiler=v;"},"sourceMaps":null,"error":null,"hash":"3a071974a739c7253cce3c6e7f01a272","cacheData":{"env":{}}}